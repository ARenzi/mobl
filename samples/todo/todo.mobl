application todo

import mobl::ui::generic
import model

screen addTask() {
  var newTask = Task()

  header("Add") {
    backButton()
    button("Add", onclick={
      add(newTask);
      screen return;
    })
  }
  group {
    item { textField(newTask.name, placeholder="Task name") }
  }
}

screen editTask(t : Task) {
  header("Edit") {
    button("Done", onclick={ screen return; })
  }
  group {
    item { textField(t.name, placeholder="Task name") }
    item { textField(t.description, placeholder="Task description") }
  }
}

screen search() {
  header("Search") {
    backButton()
  }
  var phrase = ""
  searchBox(phrase, placeholder="Search term")
  group {
    list(t in Task.searchPrefix(phrase)) {
      taskItem(t)
    }
  }
}

control taskItem(t : Task) {
  item {
    checkBox(t.done, label=t.name)
    contextMenu {
      button("Delete", onclick={
        remove(t);
      })
      button("Edit", onclick={
        editTask(t);
      })
    }
  }
}

screen root() {
  header("Tasks") {
    button("Add", onclick={ addTask(); })
  }
  group {
    list(t in Task.all() order by date desc) {
      taskItem(t)
    }
  }
  button("Search", onclick={
    search();
  })
}